<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login Dosen - UG Room</title>
    <link rel="icon" href="../assets/images/Logo-Gunadarma-Universitas-Gunadarma-Original-PNG-1140x1175 1.png" type="image/png">
    
    <link rel="stylesheet" href="../style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Almarai:wght@300;400;700;800&display=swap" rel="stylesheet">
</head>
<body>

    <nav class="navbar">
        <div class="container nav-container">
            <a href="../index.html" class="nav-brand">
                <img src="../assets/images/Logo gundar untuk navigation bar.png" alt="Logo Gunadarma">
            </a>

            <ul class="nav-menu">
                <li><a href="../index.html">Beranda</a></li>
                <li><a href="pesan-kelas.html">Pesan Kelas</a></li>
                <li><a href="info-kelas.html">Info Kelas</a></li>
                <li><a href="jadwal-kuliah.html">Jadwal Kuliah</a></li>
                <li><a href="bantuan.html">Bantuan</a></li>
            </ul>

            <div style="display: flex; align-items: center;">
                <div class="nav-search">
                    <i class="fas fa-search"></i>
                    <input type="text" placeholder="Cari Kelas...">
                </div>
                <a href="#" class="btn-login" style="background-color: #5a2a75;" id="authBtn">
    Login <i class="fas fa-sign-in-alt"></i> 
</a>
            </div>
        </div>
    </nav>

    <section class="login-section">
        <div class="login-glass-container">
            
            <div class="login-branding">
                <img src="../assets/images/Logo-Gunadarma-Universitas-Gunadarma-Original-PNG-1140x1175 1.png" alt="Logo Besar" class="login-big-logo">
                
                <div class="login-badge">
                    <span class="text-u">U</span><span class="text-g">G</span>
                    <span style="color: #fff; font-size: 2rem; font-weight: 800; margin-left: 10px; text-shadow: 0 1px 2px rgba(0,0,0,0.2);">Room</span>
                    <img src="../assets/images/logo ug room.png" alt="" style="height: 35px; width: auto;">
                </div>
            </div>

            <div class="login-form-card">
    <h2 class="login-title">Login Dosen</h2>
    
    <form id="loginForm" onsubmit="handleLogin(event)">
        
        <div class="login-input-group">
            <label class="login-label">NIP Dosen</label>
            <div class="input-with-icon">
                <i class="fas fa-user input-icon-fa"></i>
                <input type="text" id="nimInput" class="login-input" placeholder="Masukan NIP anda (8 Digit)" maxlength="8" autocomplete="off">
            </div>
        </div>

        <div class="login-input-group">
            <label class="login-label">Password</label>
            <div class="input-with-icon">
                <i class="fas fa-key input-icon-fa"></i>
                <input type="password" id="passInput" class="login-input" placeholder="Masukan password anda...">
                
            </div>
        </div>

        <div style="margin-bottom: 20px;">
            <a href="javascript:void(0)" class="login-help-link" onclick="openLoginHelp()">Ada masalah saat login?</a>
        </div>

        <button type="submit" class="btn-submit-login">Log in</button>
    </form>
</div>

<div id="modal-login-help" class="modal-overlay">
    <div class="modal-content" style="max-width: 400px; text-align: center;">
        <div class="modal-header" style="justify-content: center; border: none;">
            <h3 style="margin: 0;">ðŸ”’ Masalah Login?</h3>
        </div>
        <div class="modal-body">
            <p>Jika Anda lupa password atau akun terkunci, silakan hubungi <strong>Administrator BAAK</strong> melalui:</p>
            <div style="background: #f9f9f9; padding: 15px; border-radius: 10px; margin: 15px 0;">
                <p style="margin-bottom: 5px;"><strong>Email:</strong> admin_baak@gunadarma.ac.id</p>
                <p><strong>Telp:</strong> (021) 78881112 (Ext. 303)</p>
            </div>
            <button class="btn-submit-login" onclick="closeLoginHelp()" style="width: auto; padding: 8px 25px;">Tutup</button>
        </div>
    </div>
</div>

        </div>
    </section>

    <button class="chat-trigger-btn" id="chatTrigger" onclick="openHelpdesk()">
        <i class="fas fa-comment-dots"></i>
    </button>

    <div class="helpdesk-widget" id="helpdeskWidget">
        
        <div class="widget-content-scroll">
            
            <div id="viewHome">
                <div class="header-home">
                    <button class="btn-header-action" onclick="closeHelpdesk()" style="position: absolute; right: 20px; top: 20px;">
                        <i class="fas fa-times"></i>
                    </button>
                    <h3 class="dash-title">Helpdesk UG ROOM</h3>
                    <p class="dash-subtitle">Waktu Operasional Senin, Rabu, Kamis, dan Jumat (05.00-14.00 WIB)</p>
                </div>

                <div class="home-overlap-container">
                    <div class="card-new-chat" onclick="goToChatRoom()">
                        <div class="card-text">
                            <h4>Percakapan Baru</h4>
                            <p>Membalas dalam beberapa menit</p>
                        </div>
                        <i class="fas fa-paper-plane icon-send-purple"></i>
                    </div>
                </div>
            </div>

            <div id="viewHistory" style="display: none;">
                <div class="header-history">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <button class="btn-header-action" onclick="switchTab('home')"><i class="fas fa-chevron-left"></i></button>
                        <span>Percakapan</span>
                    </div>
                    <button class="btn-header-action" onclick="closeHelpdesk()"><i class="fas fa-times"></i></button>
                </div>

                <div class="history-container">
                    <span class="label-section">Mulai percakapan baru</span>
                    
                    <div class="card-new-chat" onclick="goToChatRoom()">
                        <div class="card-text">
                            <h4>Percakapan Baru</h4>
                            <p>Membalas dalam beberapa menit</p>
                        </div>
                        <i class="fas fa-paper-plane icon-send-purple"></i>
                    </div>

                    <span class="label-section">Terbaru</span>

                    <div class="history-item" onclick="goToChatRoom()">
                        <div class="history-item-top">
                            <span class="history-role">Helpdesk UG ROOM</span>
                            <span class="history-time">sekarang</span>
                        </div>
                        <div class="history-preview">
                            <span>Selamat datang di layanan UG...</span>
                            <i class="fas fa-chevron-right icon-arrow-right"></i>
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <div class="widget-footer" id="mainFooter">
            <button class="nav-btn active" id="btnHome" onclick="switchTab('home')">
                <i class="fas fa-home"></i>
            </button>
            <button class="nav-btn" id="btnHistory" onclick="switchTab('history')">
                <i class="far fa-comment-alt"></i>
            </button>
        </div>

        <div class="screen-chat-room" id="viewChatRoom">
            <div class="room-header">
                <div style="display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-robot"></i> <strong>UG Room Assistant</strong>
                </div>
                <button class="btn-header-action" onclick="closeHelpdesk()"><i class="fas fa-times"></i></button>
            </div>
            <div class="room-body">
                <div class="bubble-bot">Halo! ðŸ‘‹ Ada yang bisa saya bantu?</div>
            </div>
            <div class="room-footer">
                <input type="text" class="input-chat" placeholder="Ketik pesan...">
                <button class="btn-chat-send"><i class="fas fa-paper-plane"></i></button>
            </div>
            <div style="text-align: center; padding: 10px;">
                <span style="font-size: 0.8rem; color: #999; cursor: pointer; text-decoration: underline;" onclick="exitChatRoom()">Kembali</span>
            </div>
        </div>

    </div>

    <script>
        // --- LOGIC HELPDESK WIDGET (UPDATED V3) ---
        const viewHome = document.getElementById('viewHome');
        const viewHistory = document.getElementById('viewHistory');
        const viewChatRoom = document.getElementById('viewChatRoom');
        const mainFooter = document.getElementById('mainFooter');
        const btnHome = document.getElementById('btnHome');
        const btnHistory = document.getElementById('btnHistory');

        function switchTab(tab) {
            if (tab === 'home') {
                viewHome.style.display = 'block';
                viewHistory.style.display = 'none';
                
                btnHome.classList.add('active');
                btnHistory.classList.remove('active');
                btnHome.innerHTML = '<i class="fas fa-home"></i>';
                btnHistory.innerHTML = '<i class="far fa-comment-alt"></i>'; 
            } else {
                viewHome.style.display = 'none';
                viewHistory.style.display = 'block';
                
                btnHome.classList.remove('active');
                btnHistory.classList.add('active');
                btnHome.innerHTML = '<i class="fas fa-home" style="opacity:0.5"></i>';
                btnHistory.innerHTML = '<i class="fas fa-comment-alt"></i>'; 
            }
        }

        function goToChatRoom() {
            viewChatRoom.style.display = 'flex';
        }

        function exitChatRoom() {
            viewChatRoom.style.display = 'none';
            switchTab('home');
        }

        function openHelpdesk() {
            document.getElementById('chatTrigger').style.display = 'none';
            document.getElementById('helpdeskWidget').style.display = 'flex';
            switchTab('home'); 
        }

        function closeHelpdesk() {
            document.getElementById('helpdeskWidget').style.display = 'none';
            document.getElementById('chatTrigger').style.display = 'flex';
        }
    </script>

    <script>
    
    // ============================================
        // 1. DATABASE USER (DOSEN) - UPDATE LENGKAP
        // ============================================
        // NIP menggantikan NIM (8 Digit)
        // Copy variable ini ke login.html dan pesan-kelas.html juga agar sinkron
        const USERS_DB = [
            // User Lama
            { nip: "11154782", pass: "sanditaufik82", name: "Taufik Hidayat", prefLocation: "Karawaci" },
            { nip: "11123569", pass: "passhengky23", name: "Hengky Mulyono", prefLocation: "Depok" },
            
            // User Baru (Sesuai Screenshot)
            { nip: "22233445", pass: "passfitria", name: "Fitrianingsih", prefLocation: "Depok" },
            { nip: "33344556", pass: "passtaufan", name: "Muhamad Taufan", prefLocation: "Karawaci" },
            { nip: "44455667", pass: "passmudjib", name: "Muhammad Mudjib", prefLocation: "Karawaci" },
            { nip: "55566778", pass: "passagus",   name: "Agus Sulaksono", prefLocation: "Karawaci" },
            { nip: "66677889", pass: "passmiftah", name: "Miftah Andriansyah", prefLocation: "Karawaci" },
            { nip: "77788990", pass: "passdina",   name: "Dina Anggraini", prefLocation: "Karawaci" }
        ];

        // ============================================
        // 2. DATABASE JADWAL (REALISTIS)
        // ============================================
        const SCHEDULE_DB = [
            // --- SENIN (DEPOK & KARAWACI) ---
            { id: 1, day: "Senin", region: "Depok", room: "D281", time: "07.30 - 09.30", matkul: "Sistem Keamanan TI", dosen: "Fitrianingsih", status: "occupied" },
            { id: 2, day: "Senin", region: "Depok", room: "D281", time: "09.30 - 11.30", matkul: "-", dosen: "-", status: "available" },
            { id: 3, day: "Senin", region: "Karawaci", room: "K152", time: "07.30 - 08.30", matkul: "Pemrograman Berbasis Web", dosen: "Hengky Mulyono", status: "occupied" },
            { id: 4, day: "Senin", region: "Karawaci", room: "K262", time: "10.30 - 12.30", matkul: "Interaksi Manusia & Komputer", dosen: "Taufik Hidayat", status: "occupied" },
            { id: 5, day: "Senin", region: "Depok", room: "K288", time: "07.30 - 09.30", matkul: "Sistem Keamanan Teknologi Informasi", dosen: "Fitrianingsih", status: "occupied" },

            // --- SELASA (DATA DARI SCREENSHOT ANDA) ---
            // Ruang K292
            { id: 6, day: "Selasa", region: "Karawaci", room: "K292", time: "07.30 - 09.30", matkul: "Pengantar Sain Data", dosen: "Muhamad Taufan", status: "occupied" },
            { id: 7, day: "Selasa", region: "Karawaci", room: "K292", time: "09.30 - 12.30", matkul: "-", dosen: "-", status: "available" },
            
            // Ruang K258
            { id: 8, day: "Selasa", region: "Karawaci", room: "K258", time: "09.30 - 10.30", matkul: "Jejaring Sosial & Konten Kreatif", dosen: "Muhammad Mudjib", status: "occupied" },
            
            // Ruang K242
            { id: 9, day: "Selasa", region: "Karawaci", room: "K242", time: "09.30 - 10.30", matkul: "Metode Penelitian", dosen: "Agus Sulaksono", status: "occupied" },
            { id: 10, day: "Selasa", region: "Karawaci", room: "K242", time: "10.30 - 12.30", matkul: "-", dosen: "-", status: "available" },

            // Ruang K274
            { id: 11, day: "Selasa", region: "Karawaci", room: "K274", time: "08.30 - 12.30", matkul: "Graf & Analisis Algoritma", dosen: "Miftah Andriansyah", status: "occupied" },

            // Ruang K251
            { id: 12, day: "Selasa", region: "Karawaci", room: "K251", time: "07.30 - 10.30", matkul: "Konsep Data Mining", dosen: "Dina Anggraini", status: "occupied" },
            { id: 13, day: "Selasa", region: "Karawaci", room: "K251", time: "10.30 - 12.30", matkul: "-", dosen: "-", status: "available" },

            // --- RABU (MIXED) ---
            { id: 14, day: "Rabu", region: "Kalimalang", room: "J101", time: "08.30 - 11.30", matkul: "Matematika Informatika 1", dosen: "Taufik Hidayat", status: "occupied" },
            { id: 15, day: "Rabu", region: "Kalimalang", room: "J102", time: "08.30 - 11.30", matkul: "-", dosen: "-", status: "available" }
        ];

        let currentTab = 'all'; 

        document.addEventListener('DOMContentLoaded', () => {
            checkLoginNavbar();
            renderSchedule(); 
        });

        // === 3. RENDER FUNCTION (LOGIC) ===
        function renderSchedule() {
            const container = document.getElementById('scheduleContainer');
            const dayFilter = document.getElementById('filterDay').value;
            const regionFilter = document.getElementById('filterRegion').value;
            const userName = localStorage.getItem("userName"); 
            const isLoggedIn = localStorage.getItem("isLoggedIn") === "true";

            container.innerHTML = ''; 

            let filteredData = SCHEDULE_DB.filter(item => {
                if (item.day !== dayFilter) return false;

                if (currentTab === 'mine') {
                    if (!isLoggedIn) return false; 
                    return item.dosen === userName;
                } else {
                    if (regionFilter !== 'all' && item.region !== regionFilter) return false;
                    return true;
                }
            });

            if (filteredData.length === 0) {
                if (currentTab === 'mine' && !isLoggedIn) {
                    container.innerHTML = `<div class="no-data"><i class="fas fa-lock" style="font-size:3rem; margin-bottom:15px; color:#ddd;"></i><br>Silakan login untuk melihat jadwal Anda.</div>`;
                } else {
                    container.innerHTML = `<div class="no-data">Tidak ada jadwal ditemukan untuk filter ini.</div>`;
                }
                return;
            }

            filteredData.forEach(item => {
                let statusClass = '';
                let badgeHTML = '';
                let actionHTML = '';

                // Logic Tampilan Card
                if (item.dosen === userName && isLoggedIn) {
                    statusClass = 'status-mine';
                    badgeHTML = `<span class="badge badge-yellow">Kelas Anda</span>`;
                    actionHTML = `<span style="font-size:0.8rem; color:#F39C12; font-weight:700;">Sedang Berlangsung</span>`;
                } 
                else if (item.status === 'occupied') {
                    statusClass = 'status-occupied';
                    badgeHTML = `<span class="badge badge-red">Terpakai</span>`;
                    actionHTML = `<span style="font-size:0.8rem; color:#E74C3C; font-weight:600;">Tidak Tersedia</span>`;
                } 
                else {
                    statusClass = 'status-available';
                    badgeHTML = `<span class="badge badge-green">Tersedia</span>`;
                    actionHTML = `<a href="pesan-kelas.html" class="btn-book-direct">Pesan</a>`;
                }

                const html = `
                    <div class="schedule-item ${statusClass}">
                        <div class="sch-time">
                            ${item.time}
                        </div>
                        <div class="sch-info">
                            <div class="sch-title">${item.matkul !== '-' ? item.matkul : 'Ruangan Kosong'}</div>
                            <div class="sch-sub">
                                <span><i class="fas fa-door-open"></i> Ruang ${item.room}</span>
                                <span><i class="fas fa-map-marker-alt"></i> ${item.region}</span>
                                ${item.dosen !== '-' ? `<span><i class="fas fa-user-tie"></i> ${item.dosen}</span>` : ''}
                            </div>
                        </div>
                        <div class="sch-action">
                            ${badgeHTML}
                            <div style="margin-top:8px;">${actionHTML}</div>
                        </div>
                    </div>
                `;
                container.innerHTML += html;
            });
        }

        // === 4. TAB & NAVBAR LOGIC ===
        function switchScheduleTab(tab, btnElement) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            btnElement.classList.add('active');
            currentTab = tab;
            
            const isLoggedIn = localStorage.getItem("isLoggedIn") === "true";
            if (tab === 'mine' && !isLoggedIn) {
                alert("Silakan Login terlebih dahulu untuk melihat jadwal pribadi.");
            }
            renderSchedule();
        }

        function checkLoginNavbar() {
            const isLoggedIn = localStorage.getItem("isLoggedIn");
            const userName = localStorage.getItem("userName");
            const authBtn = document.getElementById('authBtn');

            if (isLoggedIn === "true" && authBtn) {
                const firstName = userName.split(" ")[0]; 
                authBtn.innerHTML = `Hi, ${firstName} <i class="fas fa-sign-out-alt"></i>`;
                authBtn.style.backgroundColor = "#E74C3C"; 
                authBtn.href = "#"; 
                authBtn.onclick = function(e) {
                    e.preventDefault();
                    if(confirm("Yakin ingin logout?")) {
                        localStorage.removeItem("isLoggedIn");
                        localStorage.removeItem("userName");
                        window.location.reload();
                    }
                };
            }
        }

        // Widget Helpdesk (Standard)
        function openHelpdesk() { document.getElementById('helpdeskWidget').style.display = 'flex'; }
        function closeHelpdesk() { document.getElementById('helpdeskWidget').style.display = 'none'; }

    // --- 2. HANDLE LOGIN ---
    // --- 2. HANDLE LOGIN ---
    function handleLogin(event) {
        event.preventDefault(); 
        
        const nimVal = document.getElementById('nimInput').value.trim();
        const passVal = document.getElementById('passInput').value.trim();

        // Validasi Dasar
        if(!nimVal || !passVal) {
            showToast("NIP dan Password wajib diisi!", "error");
            return;
        }

        // Cari User di Database Dummy
        // PERBAIKAN DISINI: Ganti 'user.nim' menjadi 'user.nip'
        const foundUser = USERS_DB.find(user => user.nip === nimVal && user.pass === passVal);

        if (foundUser) {
            // --- LOGIN SUKSES ---
            showToast(`Login Berhasil! Halo, ${foundUser.name}`, "success");
            
            // SIMPAN SESI KE BROWSER
            localStorage.setItem("isLoggedIn", "true");
            localStorage.setItem("userName", foundUser.name); 
            
            // Redirect
            setTimeout(() => {
                window.location.href = "../index.html"; 
            }, 1500);

        } else {
            // --- LOGIN GAGAL ---
            showToast("NIP atau Password salah!", "error");
        }
    }

    // --- 3. FITUR UTILITY (Toggle Pass, Toast, Modal) ---
    // (Tetap sama seperti kode sebelumnya)
    function togglePasswordVisibility() {
        const input = document.getElementById('passInput');
        const icon = document.querySelector('.toggle-password');
        
        if (input.type === "password") {
            input.type = "text";
            icon.classList.remove('fa-eye');
            icon.classList.add('fa-eye-slash');
        } else {
            input.type = "password";
            icon.classList.remove('fa-eye-slash');
            icon.classList.add('fa-eye');
        }
    }

    function showToast(msg, type) {
        const oldToast = document.querySelector('.toast-box');
        if(oldToast) oldToast.remove();

        const toast = document.createElement('div');
        toast.className = `toast-box ${type === 'success' ? 'toast-success' : 'toast-error'}`;
        const icon = type === 'success' ? '<i class="fas fa-check-circle"></i>' : '<i class="fas fa-exclamation-triangle"></i>';
        
        toast.innerHTML = `${icon} <span>${msg}</span>`;
        document.body.appendChild(toast);

        setTimeout(() => { 
            toast.style.opacity = '0'; 
            setTimeout(() => toast.remove(), 500); 
        }, 3000);
    }

    // Modal logic
    function openLoginHelp() { document.getElementById('modal-login-help').style.display = 'flex'; }
    function closeLoginHelp() { document.getElementById('modal-login-help').style.display = 'none'; }
    window.onclick = function(e) { 
        if (e.target === document.getElementById('modal-login-help')) closeLoginHelp(); 
    }
</script>

<div id="modal-login-help" class="modal-overlay">
    <div class="modal-content">
        <div style="margin-bottom: 15px;">
            <i class="fas fa-lock" style="font-size: 3rem; color: #763996;"></i>
        </div>
        <h3 style="margin-bottom: 10px; color: #333;">Kendala Login?</h3>
        <p style="color: #666; margin-bottom: 20px; font-size: 0.9rem;">
            Jika Anda lupa password atau akun terkunci, silakan hubungi <strong>Administrator BAAK</strong> atau reset melalui email kampus.
        </p>
        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px; text-align: left; font-size: 0.85rem;">
            <div style="margin-bottom: 5px;"><i class="fas fa-envelope" style="color: #763996; width: 20px;"></i> helpdesk@gunadarma.ac.id</div>
            <div><i class="fas fa-phone" style="color: #763996; width: 20px;"></i> (021) 78881112 (Ext. 303)</div>
        </div>
        <button onclick="closeLoginHelp()" class="btn-submit-login" style="width: auto; padding: 8px 30px;">Tutup</button>
    </div>
</div>

<script>
    // --- SCRIPT GLOBAL PENGATUR NAVBAR ---
    document.addEventListener('DOMContentLoaded', () => {
        // 1. Cek apakah User sudah login?
        const isLoggedIn = localStorage.getItem("isLoggedIn");
        const userName = localStorage.getItem("userName");
        
        // Ambil elemen tombol di Navbar
        const authBtn = document.getElementById('authBtn');

        if (isLoggedIn === "true" && authBtn) {
            // JIKA SUDAH LOGIN:
            
            // A. Ubah Teks Tombol jadi Nama User (atau 'Logout')
            // Kita ambil nama depan saja agar muat di navbar
            const firstName = userName.split(" ")[0]; 
            
            authBtn.innerHTML = `${firstName} <i class="fas fa-sign-out-alt"></i>`;
            
            // B. Ubah Warna Tombol jadi Merah (Visual Logout)
            authBtn.style.backgroundColor = "#E74C3C"; // Merah
            
            // C. Ubah Fungsi Tombol jadi LOGOUT
            authBtn.href = "#"; // Matikan link ke halaman login
            authBtn.onclick = function(e) {
                e.preventDefault();
                handleLogout();
            };
        }
    });

    // --- FUNGSI LOGOUT ---
    function handleLogout() {
        // Konfirmasi
        if(confirm("Apakah Anda yakin ingin keluar?")) {
            // 1. Hapus Data Sesi
            localStorage.removeItem("isLoggedIn");
            localStorage.removeItem("userName");
            
            // 2. Reload Halaman untuk mereset tampilan ke 'Login'
            window.location.reload(); 
            
            // Atau redirect ke halaman login:
            // window.location.href = "pages/login.html"; 
        }
    }
</script>

</body>
</html>